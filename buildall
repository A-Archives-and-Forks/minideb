#!/bin/bash

# Build a minideb image for each supported dist

set -e
set -u
set -o pipefail

DISTS="jessie
stretch
buster
unstable
"
DISTS_WITH_SNAPSHOT="buster"

for DIST in $DISTS; do
    ./buildone "$DIST"
done

snapshot_id=$(./snapshotid)
if [ -n "$snapshot_id" ]; then
    for DIST in $DISTS_WITH_SNAPSHOT; do
        ./buildone "$DIST" "$snapshot_id"
    done

    mkdir -p build
    echo "$snapshot_id" > build/snapshot_id
fi
